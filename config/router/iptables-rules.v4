*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# Established connections
-A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT

# Internal → External
-A FORWARD -i eth2 -o eth1 -j ACCEPT

# Internal → DMZ
-A FORWARD -i eth2 -o eth0 -j ACCEPT

# DMZ → External
-A FORWARD -i eth0 -o eth1 -j ACCEPT

# DMZ → Internal (block)
-A FORWARD -i eth0 -o eth2 -j DROP

# External → DMZ limited
-A FORWARD -i eth1 -o eth0 -p tcp --dport 80 -j ACCEPT
-A FORWARD -i eth1 -o eth0 -p tcp --dport 443 -j ACCEPT
-A FORWARD -i eth1 -o eth0 -p tcp --dport 22 -j ACCEPT

COMMIT

*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]

# NAT Internal & DMZ → External
-A POSTROUTING -s 192.168.100.0/24 -o eth1 -j MASQUERADE
-A POSTROUTING -s 10.10.10.0/24 -o eth1 -j MASQUERADE
COMMIT
